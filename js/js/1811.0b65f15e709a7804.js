"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1811],{34637:function(e,t,r){r.d(t,{Y:function(){return d},Z:function(){return p}});var n=r(59499),a=r(81719),o=r(87054),s=(r(67294),r(85893));function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var l=(0,a.ZP)(o.Z)((function(e){var t=e.theme;return{border:"0px",flex:1,backgroundColor:"#383D51",borderRadius:"4px","&.Mui-selected, &.Mui-selected:hover":{backgroundColor:"#FFFFFF",borderRadius:"4px !important"},"&.Mui-selected, &.Mui-disabled":{zIndex:100,height:"100%",display:"flex",justifyContent:"center",".MuiTypography-subheader1":{background:t.palette.gradients.aaveGradient,backgroundClip:"text",textFillColor:"transparent"},".MuiTypography-secondary14":{background:t.palette.gradients.aaveGradient,backgroundClip:"text",textFillColor:"transparent"}}}})),c=(0,a.ZP)(o.Z)((function(e){var t=e.theme;return{border:"0px",flex:1,color:t.palette.text.muted,borderRadius:"4px","&.Mui-selected, &.Mui-selected:hover":{border:"1px solid ".concat(t.palette.other.standardInputLine),backgroundColor:"#FFFFFF",borderRadius:"4px !important"},"&.Mui-selected, &.Mui-disabled":{zIndex:100,height:"100%",display:"flex",justifyContent:"center",color:t.palette.background.header}}}));function d(e){return(0,s.jsx)(c,u({},e))}function p(e){return(0,s.jsx)(l,u({},e))}},59379:function(e,t,r){r.d(t,{f:function(){return d},Z:function(){return p}});var n=r(59499),a=r(81719),o=r(85390),s=r(85893);function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var l=(0,a.ZP)(o.Z)({backgroundColor:"#383D51",border:"1px solid rgba(235, 235, 237, 0.12)",padding:"4px"}),c=(0,a.ZP)(o.Z)((function(e){return{backgroundColor:e.theme.palette.background.header,padding:"2px",height:"36px",width:"100%"}}));function d(e){return(0,s.jsx)(c,u({},e))}function p(e){return(0,s.jsx)(l,u({},e))}},81811:function(e,t,r){r.r(t),r.d(t,{RepayModal:function(){return Ae}});var n=r(59499),a=r(49501),o=r(23286),s=r(67294),i=r(47130),u=r(73965),l=r(8195),c=r(46930),d=r(63206),p=r(31959),m=r(94635),y=r(75331),b=r(1279),f=r(52358),v=r(30120),x=r(81645),g=r(29630),h=r(9144),A=r(70794),j=r(25935),S=r(41024),O=r(72667),w=r(74119),T=r(50029),P=r(87794),k=r.n(P),C=r(77537),D=r(20301),E=r(68448),R=r(53601),B=r(93608),L=r(57824),Z=r(94671),N=r(99730),I=r(17674),F=r(4730),U=r(80854),W=r(21732),M=r(50597),_=r(67489),Y=r(85893),H=["repayAmount","poolReserve","fromAssetData","isWrongNetwork","sx","symbol","rateMode","repayAllDebt","useFlashLoan","blocked","loading","repayWithAmount","buildTxFn"];function q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function V(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?q(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var G=function(e){var t,r=e.repayAmount,n=e.poolReserve,o=e.fromAssetData,s=e.isWrongNetwork,i=e.sx,u=e.symbol,l=e.rateMode,c=e.repayAllDebt,d=e.useFlashLoan,p=e.blocked,m=e.loading,b=e.repayWithAmount,f=e.buildTxFn,v=(0,F.Z)(e,H),x=(0,M.Y)((function(e){return[e.paraswapRepayWithCollateral,e.currentMarketData]})),g=(0,I.Z)(x,2),h=g[0],A=g[1],j=(0,W.P)({protocolAction:y.UQ.repayCollateral,handleGetTxns:function(){var e=(0,T.Z)(k().mark((function e(t,a){var i;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f();case 2:return i=e.sent,e.abrupt("return",h({repayAllDebt:c,repayAmount:r,rateMode:l,repayWithAmount:b,fromAssetData:o,poolReserve:n,isWrongNetwork:s,symbol:u,useFlashLoan:d,blocked:p,swapCallData:i.swapCallData,augustus:i.augustus,signature:t,deadline:a,signedAmount:(0,w.sm)(b,o.decimals)}));case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),handleGetApprovalTxns:function(){var e=(0,T.Z)(k().mark((function e(){return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",h({repayAllDebt:c,repayAmount:r,rateMode:l,repayWithAmount:b,fromAssetData:o,poolReserve:n,isWrongNetwork:s,symbol:u,useFlashLoan:!1,blocked:p,swapCallData:"0x",augustus:U.hP}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),gasLimitRecommendation:U.eB[y.UQ.repayCollateral].limit,skip:m||!r||0===parseFloat(r)||p,spender:null!==(t=A.addresses.REPAY_WITH_COLLATERAL_ADAPTER)&&void 0!==t?t:"",deps:[o.symbol,b]}),S=j.approval,O=j.action,P=j.loadingTxns,C=j.approvalTxState,D=j.mainTxState,E=j.requiresApproval;return(0,Y.jsx)(_.B,V(V({preparingTransactions:P,mainTxState:D,approvalTxState:C,requiresAmount:!0,amount:r,requiresApproval:E,isWrongNetwork:s,blocked:p,sx:i},v),{},{handleAction:O,handleApproval:function(){return S({amount:(0,w.sm)(b,o.decimals),underlyingAsset:o.aTokenAddress})},actionText:(0,Y.jsx)(a.cC,{id:"Repay {symbol}",values:{symbol:u}}),actionInProgressText:(0,Y.jsx)(a.cC,{id:"Repaying {symbol}",values:{symbol:u}}),fetchingData:m,errorParams:{loading:!1,disabled:p,content:(0,Y.jsx)(a.cC,{id:"Repay {symbol}",values:{symbol:u}}),handleClick:O},tryPermit:!0}))};function Q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function K(e){var t=e.poolReserve,r=e.symbol,n=e.debtType,o=e.userReserve,i=e.isWrongNetwork,d=e.user,p=(0,u.HT)(),m=p.reserves,P=p.userReserves,I=(0,l.vR)(),F=I.gasLimit,U=I.txError,W=I.mainTxState,M=(0,c.f)(),_=M.currentChainId,H=M.currentNetworkConfig,q=(0,C.Z)().currentAccount,V=d.userReservesData.filter((function(e){return"0"!==e.underlyingBalance&&e.underlyingAsset!==t.underlyingAsset&&"stETH"!==e.reserve.symbol})).map((function(e){return{address:e.underlyingAsset,balance:e.underlyingBalance,balanceUSD:e.underlyingBalanceUSD,symbol:e.reserve.symbol,iconSymbol:e.reserve.iconSymbol,decimals:e.reserve.decimals}})).sort((function(e,t){return Number(t.balanceUSD)-Number(e.balanceUSD)})),Q=(0,s.useState)(V[0]),K=Q[0],X=Q[1],J=K.balance||"0",$=(0,s.useState)("exactOut"),ee=$[0],te=$[1],re=(0,s.useState)(""),ne=re[0],ae=re[1],oe=(0,s.useState)("0.5"),se=oe[0],ie=oe[1],ue=(0,s.useRef)(""),le=m.find((function(e){return e.underlyingAsset===K.address})),ce=n===y.tk.Stable?(null===o||void 0===o?void 0:o.stableBorrows)||"0":(null===o||void 0===o?void 0:o.variableBorrows)||"0",de=(0,b.hE)(ce);de=de.plus(de.multipliedBy(t.variableBorrowAPY).dividedBy(17280));var pe="-1"===ne,me=pe?de.toString():ne,ye=(0,b.hE)(me).multipliedBy(t.priceInUSD).toString(),be=de.multipliedBy(t.priceInUSD).multipliedBy(100+Number(se)).dividedBy(100).dividedBy(le.priceInUSD),fe=z(z({},le),{},{amount:J}),ve=z(z({},t),{},{amount:ue.current});"exactIn"===ee&&(fe.amount=J,ve.amount="0");var xe=pe&&(0,b.hE)(J).gte(be),ge=function(e){var t=e.chainId,r=e.max,n=e.maxSlippage,a=e.skip,o=e.swapIn,i=e.swapOut,u=e.userAddress,l=e.swapVariant,c=(0,s.useState)("0"),d=c[0],p=c[1],m=(0,s.useState)("0"),y=m[0],f=m[1],v=(0,s.useState)("0"),x=v[0],g=v[1],h=(0,s.useState)("0"),A=h[0],j=h[1],S=(0,s.useState)(),O=S[0],P=S[1],C=(0,s.useState)(!1),D=C[0],E=C[1],R=(0,s.useState)(""),B=R[0],L=R[1],Z=(0,s.useMemo)((function(){return{underlyingAsset:o.underlyingAsset,decimals:o.decimals,supplyAPY:o.supplyAPY,amount:o.amount,variableBorrowAPY:o.variableBorrowAPY}}),[o.amount,o.decimals,o.supplyAPY,o.underlyingAsset,o.variableBorrowAPY]),N=(0,s.useMemo)((function(){return{underlyingAsset:i.underlyingAsset,decimals:i.decimals,supplyAPY:i.supplyAPY,amount:i.amount,variableBorrowAPY:i.variableBorrowAPY}}),[i.amount,i.decimals,i.supplyAPY,i.underlyingAsset,i.variableBorrowAPY]),I=(0,s.useCallback)((function(){return(0,w.F8)(Z,N,t,u)}),[t,Z,N,u]),F=(0,s.useCallback)((function(){return(0,w.wP)(Z,N,t,u,r)}),[t,r,Z,N,u]);return(0,s.useEffect)((function(){if(!a){var e=function(){var e=(0,T.Z)(k().mark((function e(){var t,r;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Z.underlyingAsset&&N.underlyingAsset&&("exactIn"!==l||Z.amount&&"0"!==Z.amount&&!isNaN(+Z.amount))&&("exactOut"!==l||N.amount&&"0"!==N.amount&&!isNaN(+N.amount))){e.next=7;break}return p("0"),f("0"),g("0"),j("0"),P(void 0),e.abrupt("return");case 7:if(E(!0),e.prev=8,"exactIn"!==l){e.next=15;break}return e.next=12,I();case 12:t=e.sent,e.next=18;break;case 15:return e.next=17,F();case 17:t=e.sent;case 18:L(""),P(t),p((0,b.Fv)(t.srcAmount,t.srcDecimals)),g((0,b.Fv)(t.destAmount,t.destDecimals)),f(t.srcUSD),j(t.destUSD),e.next=31;break;case 26:e.prev=26,e.t0=e.catch(8),console.error(e.t0),r=(0,w.aE)(e.t0.message),L(r);case 31:return e.prev=31,E(!1),e.finish(31);case 34:case"end":return e.stop()}}),e,null,[[8,26,31,34]])})));return function(){return e.apply(this,arguments)}}(),t=setTimeout((function(){e()}),400);return function(){clearTimeout(t)}}}),[a,l,Z.underlyingAsset,Z.amount,N.underlyingAsset,N.amount,I,F,n]),{outputAmount:x,outputAmountUSD:A,inputAmount:d,inputAmountUSD:y,loading:D,error:B,buildTxFn:function(){var e=(0,T.Z)(k().mark((function e(){return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(O){e.next=2;break}throw new Error("Route required to build transaction");case 2:if("exactIn"!==l){e.next=6;break}return e.abrupt("return",(0,w.xS)(O,o,i,t,u,n));case 6:return e.abrupt("return",(0,w._n)(O,o,i,t,u,n));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}}({chainId:H.underlyingChainId||_,userAddress:q,swapVariant:ee,swapIn:fe,swapOut:ve,max:xe,skip:W.loading||!1,maxSlippage:Number(se)}),he=ge.inputAmountUSD,Ae=ge.inputAmount,je=ge.outputAmount,Se=ge.outputAmountUSD,Oe=ge.loading,we=ge.error,Te=ge.buildTxFn,Pe=Oe&&"0"===he,ke=function(e){var t="-1"===e;t&&(0,b.hE)(J).lt(be)?(ue.current="",ae(""),te("exactIn")):(ue.current=t?de.toString(10):e,ae(e),te("exactOut"))},Ce=P.find((function(e){return e.underlyingAsset===K.address})),De=(0,E.bU)({amountToReceiveAfterSwap:je,amountToSwap:Ae,fromAssetData:le,user:d,toAssetData:t,repayWithUserReserve:Ce,debt:ce}),Ee=De.hfAfterSwap,Re=De.hfEffectOfFromAmount,Be=(0,Z.gK)(d.healthFactor,Re.toString())||(null===le||void 0===le?void 0:le.isFrozen),Le=(0,b.hE)(ce).minus(A.Z.min(je,ce)),Ze=Le.multipliedBy(t.priceInUSD),Ne=J?(0,b.hE)(J).minus(Ae):(0,b.hE)("0"),Ie=Ne.multipliedBy(le.priceInUSD),Fe="exactIn"===ee?je:me,Ue="exactIn"===ee?Se:ye,We=(0,Z.Vc)(d),Me=void 0;We.length>0&&!We.includes(K.symbol)?Me=Z.NI.ZERO_LTV_WITHDRAW_BLOCKED:(0,b.hE)(J).lt(Ae)?Me=Z.NI.NOT_ENOUGH_COLLATERAL_TO_REPAY_WITH:Be&&!le.flashLoanEnabled&&(Me=Z.NI.FLASH_LOAN_NOT_AVAILABLE);var _e=function(){switch(Me){case Z.NI.NOT_ENOUGH_COLLATERAL_TO_REPAY_WITH:return(0,Y.jsx)(a.cC,{id:"Not enough collateral to repay this amount of debt with"});case Z.NI.ZERO_LTV_WITHDRAW_BLOCKED:return(0,Y.jsx)(a.cC,{id:"Assets with zero LTV ({assetsBlockingWithdraw}) must be withdrawn or disabled as collateral to perform this action",values:{assetsBlockingWithdraw:We}});case Z.NI.FLASH_LOAN_NOT_AVAILABLE:return(0,Y.jsx)(a.cC,{id:"Due to health factor impact, a flashloan is required to perform this transaction, but Aave Governance has disabled flashloan availability for this asset. Try lowering the amount or supplying additional collateral."});default:return null}},Ye=(0,w.LN)(Ae,se,K.decimals||18),He=(0,w.IG)(je,se,t.decimals);return W.success?(0,Y.jsx)(B.R,{action:(0,Y.jsx)(a.cC,{id:"Repaid"}),amount:"exactOut"===ee?je:He,symbol:t.symbol}):(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(R.W,{value:Fe,onChange:ke,usdValue:Ue,symbol:t.symbol,assets:[{address:t.underlyingAsset,symbol:t.symbol,iconSymbol:t.iconSymbol,balance:ce}],isMaxSelected:pe,maxValue:ce,inputTitle:(0,Y.jsx)(a.cC,{id:"Expected amount to repay"}),balanceText:(0,Y.jsx)(a.cC,{id:"Borrow balance"})}),(0,Y.jsxs)(v.Z,{sx:{padding:"18px",pt:"14px",display:"flex",justifyContent:"space-between"},children:[(0,Y.jsx)(x.Z,{sx:{fontSize:"18px !important"},children:(0,Y.jsx)(f.Z,{})}),(0,Y.jsx)(j.B,{loading:Pe,outputAmountUSD:Se,inputAmountUSD:he})]}),(0,Y.jsx)(R.W,{value:"exactOut"===ee?Ae:J,usdValue:he,symbol:K.symbol,assets:V,onSelect:X,onChange:ke,inputTitle:(0,Y.jsx)(a.cC,{id:"Collateral to repay with"}),balanceText:(0,Y.jsx)(a.cC,{id:"Borrow balance"}),maxValue:J,loading:Pe,disableInput:!0}),we&&!Pe&&(0,Y.jsx)(g.Z,{variant:"helperText",color:"error.main",children:we}),void 0!==Me&&(0,Y.jsx)(g.Z,{variant:"helperText",color:"error.main",children:(0,Y.jsx)(_e,{})}),(0,Y.jsxs)(L.m6,{gasLimit:F,slippageSelector:(0,Y.jsx)(D.n,{selectedSlippage:se,setSlippage:ie,slippageTooltipHeader:(0,Y.jsx)(h.Z,{direction:"row",alignItems:"center",children:"exactIn"===ee?(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(a.cC,{id:"Minimum amount of debt to be repaid"}),(0,Y.jsx)(h.Z,{alignItems:"end",children:(0,Y.jsxs)(h.Z,{direction:"row",children:[(0,Y.jsx)(O.T1,{symbol:t.iconSymbol,sx:{mr:1,fontSize:"14px"}}),(0,Y.jsx)(S.B,{value:He,variant:"secondary12"})]})})]}):(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(a.cC,{id:"Maximum collateral amount to use"}),(0,Y.jsx)(h.Z,{alignItems:"end",children:(0,Y.jsxs)(h.Z,{direction:"row",children:[(0,Y.jsx)(O.T1,{symbol:K.iconSymbol||"",sx:{mr:1,fontSize:"14px"}}),(0,Y.jsx)(S.B,{value:Ye,variant:"secondary12"})]})})]})})}),children:[(0,Y.jsx)(L.jz,{visibleHfChange:"exactOut"===ee?!!ne:!!Ae,healthFactor:null===d||void 0===d?void 0:d.healthFactor,futureHealthFactor:Ee.toString(10),loading:Pe}),(0,Y.jsx)(L.XJ,{description:(0,Y.jsx)(a.cC,{id:"Borrow balance after repay"}),futureValue:Le.toString(),futureValueUSD:Ze.toString(),symbol:r,tokenIcon:t.iconSymbol,loading:Pe,hideSymbolSuffix:!0}),(0,Y.jsx)(L.XJ,{description:(0,Y.jsx)(a.cC,{id:"Collateral balance after repay"}),futureValue:Ne.toString(),futureValueUSD:Ie.toString(),symbol:K.symbol,tokenIcon:K.iconSymbol,loading:Pe,hideSymbolSuffix:!0})]}),U&&(0,Y.jsx)(N.f,{txError:U}),(0,Y.jsx)(G,{poolReserve:t,fromAssetData:le,repayAmount:"exactIn"===ee?He:je,repayWithAmount:"exactOut"===ee?Ye:Ae,repayAllDebt:xe,useFlashLoan:Be,isWrongNetwork:i,symbol:r,rateMode:n,blocked:void 0!==Me||""!==we,loading:Oe,buildTxFn:Te})]})}var X=r(84707),J=r(82403),$=r(20854),ee=r(69125),te=r(67916),re=r(85945),ne=r(56371),ae=r(28744),oe=r(93591),se=r(32113),ie=r(39771),ue=r(31001),le=["amountToRepay","poolReserve","poolAddress","isWrongNetwork","sx","symbol","debtType","repayWithATokens","blocked","maxApproveNeeded"];function ce(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function de(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ce(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ce(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var pe,me=function(e){var t=e.amountToRepay,r=e.poolReserve,n=e.poolAddress,o=e.isWrongNetwork,i=e.sx,u=e.symbol,c=e.debtType,d=e.repayWithATokens,p=e.blocked,m=e.maxApproveNeeded,b=(0,F.Z)(e,le),f=(0,M.Y)((function(e){return[e.repay,e.repayWithPermit,e.encodeRepayParams,e.encodeRepayWithPermitParams,e.tryPermit,e.walletApprovalMethodPreference,e.estimateGasLimit,e.addTransaction,e.useOptimizedPath,e.currentMarketData]})),v=(0,I.Z)(f,10),x=v[0],g=v[1],h=v[2],A=v[3],j=v[4],S=v[5],O=v[6],w=v[7],P=v[8],D=v[9],E=(0,C.Z)().sendTx,R=(0,re.NL)(),B=(0,s.useState)(),L=B[0],N=B[1],W=(0,l.vR)(),H=W.approvalTxState,q=W.mainTxState,V=W.loadingTxns,G=W.setMainTxState,Q=W.setTxError,z=W.setGasLimit,K=W.setLoadingTxns,X=W.setApprovalTxState,J=(0,oe.y)(D,n),$=J.data,ee=J.refetch,te=J.isFetching,ce=J.isFetchedAfterMount,pe=j({reserveAddress:n,isWrappedBaseAsset:r.isWrappedBaseAsset}),me=pe&&S===se.n.PERMIT;K(te);var ye=!d&&0!==Number(t)&&(0,Z.iv)({approvedAmount:(null===$||void 0===$?void 0:$.amount)||"0",amount:-1===Number(t)?m:t,signedAmount:L?L.amount:"0"});ye&&null!==H&&void 0!==H&&H.success&&X({});var be=(0,ae.M)({usePermit:me,approvedAmount:$,requiresApproval:ye,assetAddress:n,symbol:u,decimals:r.decimals,signatureAmount:t,onApprovalTxConfirmed:ee,onSignTxCompleted:function(e){return N(e)}}).approval;(0,s.useEffect)((function(){ce||d||ee()}),[ee,ce,d]);var fe=function(){var e=(0,T.Z)(k().mark((function e(){var a,o,s,i,l,p,m,b,f;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,G(de(de({},q),{},{loading:!0})),o=y.UQ.default,!me||!L){e.next=21;break}if(s={amount:"-1"===t?t:(0,ne.parseUnits)(t,r.decimals).toString(),reserve:n,interestRateMode:c,signature:L.signature,deadline:L.deadline},!P()){e.next=9;break}return e.next=8,A(s);case 8:i=e.sent;case 9:return o=y.UQ.repayWithPermit,l=g(de(de({},s),{},{encodedTxData:i?i[0]:void 0})),e.next=13,O(l);case 13:return l=e.sent,e.next=16,E(l);case 16:return a=e.sent,e.next=19,a.wait(1);case 19:e.next=36;break;case 21:if(p={amountToRepay:"-1"===t?t:(0,ne.parseUnits)(t,r.decimals).toString(),poolAddress:n,repayWithATokens:d,debtType:c},!P()){e.next=26;break}return e.next=25,h(p);case 25:m=e.sent;case 26:return o=y.UQ.repay,b=x(de(de({},p),{},{encodedTxData:m})),e.next=30,O(b);case 30:return b=e.sent,e.next=33,E(b);case 33:return a=e.sent,e.next=36,a.wait(1);case 36:G({txHash:a.hash,loading:!1,success:!0}),w(a.hash,{action:o,txState:"success",asset:n,amount:t,assetName:u}),R.invalidateQueries({queryKey:ue.B.pool}),R.invalidateQueries({queryKey:ue.B.gho}),e.next=47;break;case 42:e.prev=42,e.t0=e.catch(0),f=(0,ie.WG)(e.t0,ie.aD.GAS_ESTIMATION,!1),Q(f),G({txHash:void 0,loading:!1});case 47:case"end":return e.stop()}}),e,null,[[0,42]])})));return function(){return e.apply(this,arguments)}}();return(0,s.useEffect)((function(){var e=0;me?e=Number(U.eB[y.UQ.supplyWithPermit].recommended):(e=Number(U.eB[y.UQ.supply].recommended),ye&&!H.success&&(e+=Number(Z.pQ))),z(e.toString())}),[ye,H,me,z]),(0,Y.jsx)(_.B,de(de({blocked:p,preparingTransactions:V||!$,symbol:r.symbol,mainTxState:q,approvalTxState:H,requiresAmount:!0,amount:t,requiresApproval:ye,isWrongNetwork:o,sx:i},b),{},{handleAction:fe,handleApproval:be,actionText:(0,Y.jsx)(a.cC,{id:"Repay {symbol}",values:{symbol:u}}),actionInProgressText:(0,Y.jsx)(a.cC,{id:"Repaying {symbol}",values:{symbol:u}}),tryPermit:pe}))},ye=function(e){var t,r,n,o=e.poolReserve,i=e.userReserve,p=e.symbol,m=e.tokenBalance,f=e.nativeBalance,v=e.isWrongNetwork,x=e.debtType,h=e.user,j=(0,l.vR)(),S=j.gasLimit,O=j.mainTxState,w=j.txError,T=(0,u.HT)().marketReferencePriceInUsd,P=(0,c.f)(),k=P.currentChainId,C=P.currentMarketData,D=P.currentMarket,E=(0,M.Y)((function(e){return[e.poolComputed.minRemainingBaseTokenBalance]})),Z=(0,I.Z)(E,1)[0],N=(0,s.useState)({address:o.underlyingAsset,symbol:o.symbol,iconSymbol:o.iconSymbol,balance:m}),F=N[0],W=N[1],_=(0,s.useState)([F]),H=_[0],q=_[1],V=(0,s.useState)(""),G=V[0],Q=V[1],z=(0,s.useState)(""),K=z[0],re=z[1],ne=(0,s.useRef)(),ae=(0,d.Mo)(k),oe=i.underlyingBalance,se=i.usageAsCollateralEnabledOnUser,ie=i.reserve,ue=F.address===o.aTokenAddress,le=x===y.tk.Stable?(null===i||void 0===i?void 0:i.stableBorrows)||"0":(null===i||void 0===i?void 0:i.variableBorrows)||"0",ce=new A.Z(le).multipliedBy(o.formattedPriceInMarketReferenceCurrency).multipliedBy(T).shiftedBy(-J.$3),de=(0,b.hE)(le).multipliedBy("1.0025").decimalPlaces(o.decimals,A.Z.ROUND_UP);if(ue)r=A.Z.min(oe,le),n=oe;else{var pe=(0,b.hE)(F.balance).minus((null===i||void 0===i?void 0:i.reserve.symbol.toUpperCase())===ae.baseAssetSymbol?Z:"0");n=pe.toString(10),r=A.Z.min(pe,le)}var ye="-1"===K,be=ye?r.toString(10):K;(0,s.useEffect)((function(){var e=[];if(o.symbol===ae.wrappedBaseAssetSymbol){var t=(0,b.hE)(f),r=A.Z.max(t,A.Z.min(t,le));e.push({address:U.hP.toLowerCase(),symbol:ae.baseAssetSymbol,balance:r.toString(10)})}var n=A.Z.min((0,b.hE)(m),le),a=A.Z.max(n,m);if(e.push({address:o.underlyingAsset,symbol:o.symbol,iconSymbol:o.iconSymbol,balance:a.toString(10)}),C.v3&&!(0,ee.rj)({symbol:o.symbol,currentMarket:D})){var s=(0,b.hE)(oe),i=A.Z.max(s,A.Z.min(s,le).toString(10));e.push({address:o.aTokenAddress,symbol:"a".concat(o.symbol),iconSymbol:o.iconSymbol,aToken:!0,balance:i.toString(10)})}q(e),W(e[0])}),[]);var fe=(0,b.hE)(le).minus(be||"0").toString(10),ve=new A.Z(fe).multipliedBy(o.formattedPriceInMarketReferenceCurrency).multipliedBy(T).shiftedBy(-J.$3),xe=ye&&ve.toNumber()>0,ge=null===h||void 0===h?void 0:h.healthFactor;if(be){var he=(null===h||void 0===h?void 0:h.totalCollateralUSD)||"0";ue&&se&&(he=(0,b.hE)((null===h||void 0===h?void 0:h.totalCollateralUSD)||"0").minus((0,b.hE)(ie.priceInUSD).multipliedBy(be)));var Ae=(0,b.hE)((null===h||void 0===h?void 0:h.totalBorrowsUSD)||"0").minus((0,b.hE)(ie.priceInUSD).multipliedBy(be)),je=A.Z.max(Ae,0),Se=(0,$.L1)({collateralBalanceMarketReferenceCurrency:he,borrowBalanceMarketReferenceCurrency:je,currentLiquidationThreshold:(null===h||void 0===h?void 0:h.currentLiquidationThreshold)||"0"});ge=Se.isLessThan(0)&&!Se.eq(-1)?"0":Se.toString(10)}var Oe=(0,b.hE)(be).multipliedBy(ie.priceInUSD);return O.success?(0,Y.jsx)(B.R,{action:(0,Y.jsx)(a.cC,{id:"repaid"}),amount:ne.current,symbol:ue?o.symbol:F.symbol}):(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(R.W,{value:be,onChange:function(e){var t="-1"===e;ne.current=t?r.toString(10):e,re(e),t&&(ue||r.eq(le))?F.address===U.hP.toLowerCase()||X.U[k]&&X.U[k].toLowerCase()===ie.underlyingAsset.toLowerCase()?Q(de.toString(10)):Q("-1"):Q(de.lt(n)?de.toString(10):r.toString(10))},usdValue:Oe.toString(10),symbol:F.symbol,assets:H,onSelect:W,isMaxSelected:ye,maxValue:r.toString(10),balanceText:(0,Y.jsx)(a.cC,{id:"Wallet balance"})}),xe&&(0,Y.jsx)(g.Z,{color:"warning.main",variant:"helperText",children:(0,Y.jsx)(a.cC,{id:"You don\u2019t have enough funds in your wallet to repay the full amount. If you proceed to repay with your current amount of funds, you will still have a small borrowing position in your dashboard."})}),(0,Y.jsxs)(L.m6,{gasLimit:S,children:[(0,Y.jsx)(L.XJ,{description:(0,Y.jsx)(a.cC,{id:"Remaining debt"}),futureValue:fe,futureValueUSD:ve.toString(10),value:le,valueUSD:ce.toString(),symbol:o.iconSymbol===ae.wrappedBaseAssetSymbol?ae.baseAssetSymbol:o.iconSymbol}),(0,Y.jsx)(L.jz,{visibleHfChange:!!K,healthFactor:null===h||void 0===h?void 0:h.healthFactor,futureHealthFactor:ge})]}),w&&(0,Y.jsx)(te.Q,{txError:w}),(0,Y.jsx)(me,{maxApproveNeeded:de.toString(),poolReserve:o,amountToRepay:ye?G:be,poolAddress:ue?o.underlyingAsset:null!==(t=F.address)&&void 0!==t?t:"",isWrongNetwork:v,symbol:p,debtType:x,repayWithATokens:ue})]})},be=r(34637),fe=r(59379),ve=r(57609);function xe(e){var t,r=e.repayType,n=e.setRepayType,o=(0,c.f)().currentMarketData,s=(0,M.Y)((function(e){return e.trackEvent}));return null!==(t=o.enabledFeatures)&&void 0!==t&&t.collateralRepay?(0,Y.jsxs)(v.Z,{sx:{mb:6},children:[(0,Y.jsx)(g.Z,{mb:1,color:"text.secondary",children:(0,Y.jsx)(a.cC,{id:"Repay with"})}),(0,Y.jsxs)(fe.f,{color:"primary",value:r,exclusive:!0,onChange:function(e,t){return n(t)},children:[(0,Y.jsx)(be.Y,{value:pe.BALANCE,disabled:r===pe.BALANCE,onClick:function(){return s(ve.rQ.SWITCH_REPAY_TYPE,{repayType:"Wallet Balance"})},children:(0,Y.jsx)(g.Z,{variant:"buttonM",children:(0,Y.jsx)(a.cC,{id:"Wallet balance"})})}),(0,Y.jsx)(be.Y,{value:pe.COLLATERAL,disabled:r===pe.COLLATERAL,onClick:function(){return s(ve.rQ.SWITCH_REPAY_TYPE,{repayType:"Collateral"})},children:(0,Y.jsx)(g.Z,{variant:"buttonM",children:(0,Y.jsx)(a.cC,{id:"Collateral"})})})]})]}):null}function ge(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function he(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ge(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ge(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}!function(e){e[e.BALANCE=0]="BALANCE",e[e.COLLATERAL=1]="COLLATERAL"}(pe||(pe={}));var Ae=function(){var e,t=(0,l.vR)(),r=t.type,n=t.close,y=t.args,b=t.mainTxState,f=(0,u.HT)(),v=f.userReserves,x=f.reserves,g=(0,c.f)().currentMarketData,h=(0,s.useState)(pe.BALANCE),A=h[0],j=h[1],S=null===(e=x.find((function(e){return"stETH"===e.symbol})))||void 0===e?void 0:e.underlyingAsset,O=d.cr.collateralRepay(g)&&v.some((function(e){return"0"!==e.scaledATokenBalance&&e.underlyingAsset!==y.underlyingAsset&&e.underlyingAsset!==S}));return(0,Y.jsx)(p.P,{open:r===l.w8.Repay,setOpen:function(){j(pe.BALANCE),n()},children:(0,Y.jsx)(m.A,{title:(0,Y.jsx)(a.cC,{id:"Repay"}),underlyingAsset:y.underlyingAsset,requiredPermission:o.g.BORROWER,children:function(e){return(0,Y.jsx)(i.X,{children:function(t){return(0,Y.jsxs)(Y.Fragment,{children:[O&&!b.txHash&&(0,Y.jsx)(xe,{repayType:A,setRepayType:j}),A===pe.BALANCE&&(0,Y.jsx)(ye,he(he({},e),{},{debtType:y.currentRateMode,user:t})),A===pe.COLLATERAL&&(0,Y.jsx)(K,he(he({},e),{},{debtType:y.currentRateMode,user:t}))]})}})}})})}},28744:function(e,t,r){r.d(t,{M:function(){return g}});var n=r(59499),a=r(50029),o=r(17674),s=r(87794),i=r.n(s),u=r(75331),l=r(80854),c=r(21046),d=r(56371),p=r(89291),m=r(77537),y=r(50597),b=r(39771),f=r(8195);function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function x(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var g=function(e){var t=e.usePermit,r=e.approvedAmount,n=e.requiresApproval,s=e.assetAddress,v=e.symbol,g=e.decimals,h=e.signatureAmount,A=e.onApprovalTxConfirmed,j=e.onSignTxCompleted,S=(0,y.Y)((function(e){return[e.generateApproval,e.generateSignatureRequest,e.estimateGasLimit,e.addTransaction]})),O=(0,o.Z)(S,4),w=O[0],T=O[1],P=O[2],k=O[3],C=(0,m.Z)(),D=C.signTxData,E=C.sendTx,R=(0,f.vR)(),B=R.approvalTxState,L=R.setApprovalTxState,Z=R.setTxError,N=function(){var e=(0,a.Z)(i().mark((function e(){var a,o,m,y,f,S;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!n||!r){e.next=30;break}if(!t){e.next=16;break}return L(x(x({},B),{},{loading:!0})),a=Math.floor(Date.now()/1e3+3600).toString(),e.next=7,T(x(x({},r),{},{deadline:a,amount:"-1"===h?c.Bz.toString():(0,d.parseUnits)(h,g).toString()}));case 7:return o=e.sent,e.next=10,D(o);case 10:m=e.sent,j&&j({signature:m,deadline:a,amount:h}),Z(void 0),L({txHash:p.Z,loading:!1,success:!0}),e.next=30;break;case 16:return y=w(r),L(x(x({},B),{},{loading:!0})),e.next=20,P(y);case 20:return y=e.sent,e.next=23,E(y);case 23:return f=e.sent,e.next=26,f.wait(1);case 26:L({txHash:f.hash,loading:!1,success:!0}),Z(void 0),k(f.hash,{action:u.UQ.approval,txState:"success",asset:s,amount:l.ke,assetName:v}),A&&A();case 30:e.next=37;break;case 32:e.prev=32,e.t0=e.catch(0),S=(0,b.WG)(e.t0,b.aD.GAS_ESTIMATION,!1),Z(S),L({txHash:void 0,loading:!1});case 37:case"end":return e.stop()}}),e,null,[[0,32]])})));return function(){return e.apply(this,arguments)}}();return{approval:N}}},93591:function(e,t,r){r.d(t,{i:function(){return i},y:function(){return u}});var n=r(36492),a=r(50597),o=r(31001),s=r(98386),i=function(e){var t=e.marketData,r=e.token,i=e.spender,u=(0,s.z)().approvedAmountService,l=(0,a.Y)((function(e){return e.account}));return(0,n.a)({queryFn:function(){return u.getApprovedAmount(t,l,r,i)},queryKey:o.B.approvedAmount(l,r,i,t)})},u=function(e,t){var r=(0,s.z)().approvedAmountService,i=(0,a.Y)((function(e){return e.account}));return(0,n.a)({queryFn:function(){return r.getPoolApprovedAmount(e,i,t)},queryKey:o.B.poolApprovedAmount(i,t,e)})}}}]);